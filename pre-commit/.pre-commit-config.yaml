# Guardian: Carter | Ministry: Identity | Maturity: v1.0.1
# Purpose: Gatekeeper vâˆž.5.2 pre-commit hooks for RylanLabs
# Compliance: Seven Pillars, Trinity Pattern, Hellodeolu v6
# Version: v1.0.0
# Last Updated: 2025-12-31

repos:
  # === CORE HYGIENE (pre-commit-hooks) ===
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0  # Updated 2024-12
    hooks:
      - id: trailing-whitespace
        name: Remove trailing whitespace
      - id: end-of-file-fixer
        name: Ensure files end with newline
      - id: check-yaml
        name: Validate YAML syntax
        args: [--unsafe]  # Allow custom tags (Ansible, etc.)
      - id: check-added-large-files
        name: Block files >1MB
        args: ['--maxkb=1024']
      - id: check-merge-conflict
        name: Detect merge conflict markers
      - id: detect-private-key
        name: Block committed secrets
      - id: check-case-conflict
        name: Detect case-insensitive filename conflicts
      - id: mixed-line-ending
        name: Enforce LF line endings
        args: [--fix=lf]

  # === YAML LINTING (yamllint) ===
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1  # Updated 2024-03
    hooks:
      - id: yamllint
        name: Lint YAML files
        args: [-c, linting/.yamllint]
        types: [yaml]

  # === PYTHON FORMATTING (black) ===
  - repo: https://github.com/psf/black
    rev: 24.10.0  # Updated 2024-10
    hooks:
      - id: black
        name: Format Python code
        args: [--line-length=160]
        language_version: python3.12

  # === PYTHON LINTING (ruff) ===
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4  # Updated 2024-12
    hooks:
      - id: ruff
        name: Lint Python code
        args: [--fix, --exit-non-zero-on-fix]
        types: [python]

  # === PYTHON TYPE CHECKING (mypy) ===
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.1  # Updated 2024-11
    hooks:
      - id: mypy
        name: Type check Python code
        args: [--config-file=linting/pyproject.toml]
        additional_dependencies:
          - types-PyYAML
          - types-requests
          - types-setuptools

  # === BASH LINTING (shellcheck) ===
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.10.0.1  # Updated 2024-11
    hooks:
      - id: shellcheck
        name: Lint bash scripts
        args: [-x]  # Follow sourced files
        types: [shell]

  # === BASH FORMATTING (shfmt) ===
  - repo: https://github.com/scop/pre-commit-shfmt
    rev: v3.10.0-2  # Updated 2024-12
    hooks:
      - id: shfmt
        name: Format bash scripts
        args: [-i, '2', -ci, -sr, -w]
        # -i 2: 2-space indent
        # -ci: indent case statements
        # -sr: redirect operators followed by space
        # -w: write result to file
        types: [shell]

  # === MARKDOWN LINTING (markdownlint) ===
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.42.0  # Updated 2024-10
    hooks:
      - id: markdownlint
        name: Lint Markdown files
        args: [--fix]
        types: [markdown]

  # === JSON VALIDATION ===
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: check-json
        name: Validate JSON syntax
        types: [json]
      - id: pretty-format-json
        name: Format JSON files
        args: [--autofix, --indent=2]
        types: [json]

  # === ANSIBLE LINTING (ansible-lint) ===
  # NOTE: Disabled temporarily due to upstream ansible-lint incompatibility
  # The hook has unresolved dependency conflicts between ansible-lint v6.22.2 and
  # its transitive ansible-core dependency. Related issues:
  # - ansible/ansible-lint#2547 (ModuleNotFoundError: ansible.parsing.yaml.constructor)
  # Workaround: Run ansible-lint manually in active environment: `ansible-lint`
  # TODO: Re-enable when upstream fixes dependency resolution
  # - repo: https://github.com/ansible/ansible-lint
  #   rev: v6.22.2
  #   hooks:
  #     - id: ansible-lint
  #       name: Lint Ansible playbooks/roles
  #       files: \.(ya?ml)$
  #       exclude: ^(?!.*(playbooks|roles|playbook)).*$
  #       args: [--force-color, --offline]

  # === SECURITY SCANNING (bandit) ===
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10  # Updated 2024-10
    hooks:
      - id: bandit
        name: Security scan Python code
        args: [-c, linting/pyproject.toml, -r]
        types: [python]
        # Configured in pyproject.toml [tool.bandit]

  # === COMMIT MESSAGE LINTING (commitizen) ===
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v3.29.1  # Updated 2024-09
    hooks:
      - id: commitizen
        name: Validate commit message format
        stages: [commit-msg]
        # Enforces conventional commits: feat:, fix:, chore:, etc.

# === CONFIGURATION ===
default_language_version:
  python: python3.12

default_stages: [pre-commit, pre-push]

fail_fast: false  # Run all hooks even if one fails

minimum_pre_commit_version: '3.0.0'
